<div class="settings-container">
  <div class="d-flex justify-content-center">
    <div class="col-md-10">
      @if (settingsForm.value.login) {
        <h2 class="profile-title">
          <svg width="32" height="32" viewBox="0 0 24 24" fill="none" class="title-icon">
            <path
              d="M20 21V19C20 17.9391 19.5786 16.9217 18.8284 16.1716C18.0783 15.4214 17.0609 15 16 15H8C6.93913 15 5.92172 15.4214 5.17157 16.1716C4.42143 16.9217 4 17.9391 4 19V21"
              stroke="currentColor"
              stroke-width="2"
              stroke-linecap="round"
              stroke-linejoin="round"
            />
            <circle cx="12" cy="7" r="4" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
          </svg>
          {{ 'settings.titlePrefix' | translate }} <strong>{{ settingsForm.value.firstName }} {{ settingsForm.value.lastName }}</strong>
        </h2>
      }

      @if (success()) {
        <div class="alert alert-success" jhiTranslate="settings.messages.success"><strong>Votre profil a été sauvegardé !</strong></div>
      }

      <jhi-alert-error />

      @if (settingsForm.value.login) {
        <form name="form" (ngSubmit)="save()" [formGroup]="settingsForm" novalidate class="modern-form">
          <div class="form-group-modern">
            <label class="form-label-modern" for="firstName" jhiTranslate="settings.form.firstname">
              <svg width="20" height="20" viewBox="0 0 24 24" fill="none" class="label-icon">
                <path
                  d="M20 21V19C20 17.9391 19.5786 16.9217 18.8284 16.1716C18.0783 15.4214 17.0609 15 16 15H8C6.93913 15 5.92172 15.4214 5.17157 16.1716C4.42143 16.9217 4 17.9391 4 19V21"
                  stroke="currentColor"
                  stroke-width="2"
                  stroke-linecap="round"
                  stroke-linejoin="round"
                />
                <circle cx="12" cy="7" r="4" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
              </svg>
              {{ 'settings.form.firstname' | translate }}
            </label>
            <div class="input-container">
              <input
                type="text"
                class="form-input-modern"
                id="firstName"
                name="firstName"
                placeholder="{{ 'settings.form.firstname.placeholder' | translate }}"
                formControlName="firstName"
                data-cy="firstname"
              />
              <div class="input-icon">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none">
                  <path
                    d="M20 21V19C20 17.9391 19.5786 16.9217 18.8284 16.1716C18.0783 15.4214 17.0609 15 16 15H8C6.93913 15 5.92172 15.4214 5.17157 16.1716C4.42143 16.9217 4 17.9391 4 19V21"
                    stroke="currentColor"
                    stroke-width="2"
                    stroke-linecap="round"
                    stroke-linejoin="round"
                  />
                  <circle cx="12" cy="7" r="4" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
                </svg>
              </div>
            </div>

            @let firstNameRef = settingsForm.get('firstName')!;
            @if (firstNameRef.invalid && (firstNameRef.dirty || firstNameRef.touched)) {
              <div>
                @if (firstNameRef?.errors?.required) {
                  <small class="form-text text-danger" jhiTranslate="settings.messages.validate.firstname.required"
                    >Votre prénom est requis.</small
                  >
                }

                @if (firstNameRef?.errors?.minlength) {
                  <small class="form-text text-danger" jhiTranslate="settings.messages.validate.firstname.minlength"
                    >Votre prénom doit comporter au moins un caractère.</small
                  >
                }

                @if (firstNameRef?.errors?.maxlength) {
                  <small class="form-text text-danger" jhiTranslate="settings.messages.validate.firstname.maxlength"
                    >Votre prénom ne doit pas comporter plus de 50 caractères.</small
                  >
                }
              </div>
            }
          </div>

          <div class="form-group-modern">
            <label class="form-label-modern" for="lastName" jhiTranslate="settings.form.lastname">
              <svg width="20" height="20" viewBox="0 0 24 24" fill="none" class="label-icon">
                <path
                  d="M20 21V19C20 17.9391 19.5786 16.9217 18.8284 16.1716C18.0783 15.4214 17.0609 15 16 15H8C6.93913 15 5.92172 15.4214 5.17157 16.1716C4.42143 16.9217 4 17.9391 4 19V21"
                  stroke="currentColor"
                  stroke-width="2"
                  stroke-linecap="round"
                  stroke-linejoin="round"
                />
                <circle cx="12" cy="7" r="4" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
              </svg>
              {{ 'settings.form.lastname' | translate }}
            </label>
            <div class="input-container">
              <input
                type="text"
                class="form-input-modern"
                id="lastName"
                name="lastName"
                placeholder="{{ 'settings.form.lastname.placeholder' | translate }}"
                formControlName="lastName"
                data-cy="lastname"
              />
              <div class="input-icon">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none">
                  <path
                    d="M20 21V19C20 17.9391 19.5786 16.9217 18.8284 16.1716C18.0783 15.4214 17.0609 15 16 15H8C6.93913 15 5.92172 15.4214 5.17157 16.1716C4.42143 16.9217 4 17.9391 4 19V21"
                    stroke="currentColor"
                    stroke-width="2"
                    stroke-linecap="round"
                    stroke-linejoin="round"
                  />
                  <circle cx="12" cy="7" r="4" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
                </svg>
              </div>
            </div>

            @let lastNameRef = settingsForm.get('lastName')!;
            @if (lastNameRef.invalid && (lastNameRef.dirty || lastNameRef.touched)) {
              <div>
                @if (lastNameRef?.errors?.required) {
                  <small class="form-text text-danger" jhiTranslate="settings.messages.validate.lastname.required"
                    >Votre nom est requis.</small
                  >
                }

                @if (lastNameRef?.errors?.minlength) {
                  <small class="form-text text-danger" jhiTranslate="settings.messages.validate.lastname.minlength"
                    >Votre nom doit comporter au moins un caractère.</small
                  >
                }

                @if (lastNameRef?.errors?.maxlength) {
                  <small class="form-text text-danger" jhiTranslate="settings.messages.validate.lastname.maxlength"
                    >Votre nom ne doit pas comporter plus de 50 caractères.</small
                  >
                }
              </div>
            }
          </div>

          <div class="form-group-modern">
            <label class="form-label-modern" for="email" jhiTranslate="global.form.email.label">
              <svg width="20" height="20" viewBox="0 0 24 24" fill="none" class="label-icon">
                <path
                  d="M4 4H20C21.1 4 22 4.9 22 6V18C22 19.1 21.1 20 20 20H4C2.9 20 2 19.1 2 18V6C2 4.9 2.9 4 4 4Z"
                  stroke="currentColor"
                  stroke-width="2"
                  stroke-linecap="round"
                  stroke-linejoin="round"
                />
                <polyline points="22,6 12,13 2,6" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
              </svg>
              {{ 'global.form.email.label' | translate }}
            </label>
            <div class="input-container">
              <input
                type="email"
                class="form-input-modern"
                id="email"
                name="email"
                placeholder="{{ 'global.form.email.placeholder' | translate }}"
                formControlName="email"
                data-cy="email"
              />
              <div class="input-icon">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none">
                  <path
                    d="M4 4H20C21.1 4 22 4.9 22 6V18C22 19.1 21.1 20 20 20H4C2.9 20 2 19.1 2 18V6C2 4.9 2.9 4 4 4Z"
                    stroke="currentColor"
                    stroke-width="2"
                    stroke-linecap="round"
                    stroke-linejoin="round"
                  />
                  <polyline points="22,6 12,13 2,6" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
                </svg>
              </div>
            </div>

            @let emailRef = settingsForm.get('email')!;
            @if (emailRef.invalid && (emailRef.dirty || emailRef.touched)) {
              <div>
                @if (emailRef?.errors?.required) {
                  <small class="form-text text-danger" jhiTranslate="global.messages.validate.email.required"
                    >Votre email est requis.</small
                  >
                }

                @if (emailRef?.errors?.email) {
                  <small class="form-text text-danger" jhiTranslate="global.messages.validate.email.invalid"
                    >Votre email n&apos;est pas valide.</small
                  >
                }

                @if (emailRef?.errors?.minlength) {
                  <small class="form-text text-danger" jhiTranslate="global.messages.validate.email.minlength"
                    >Votre email doit comporter au moins 5 caractères.</small
                  >
                }

                @if (emailRef?.errors?.maxlength) {
                  <small class="form-text text-danger" jhiTranslate="global.messages.validate.email.maxlength"
                    >Votre email ne doit pas comporter plus de 50 caractères.</small
                  >
                }
              </div>
            }
          </div>

          <div class="form-group-modern">
            <label class="form-label-modern" for="phone" jhiTranslate="settings.form.phone">
              <svg width="20" height="20" viewBox="0 0 24 24" fill="none" class="label-icon">
                <path
                  d="M22 16.92V19.92C22.0011 20.1985 21.9441 20.4742 21.8325 20.7293C21.7209 20.9845 21.5573 21.2136 21.3521 21.4019C21.1468 21.5901 20.9046 21.7335 20.6407 21.8227C20.3769 21.9119 20.0974 21.9451 19.82 21.92C16.7428 21.5856 13.787 20.5341 11.19 18.85C8.77382 17.3147 6.72533 15.2662 5.18999 12.85C3.49997 10.2412 2.44824 7.27099 2.11999 4.18C2.095 3.90347 2.12787 3.62476 2.21649 3.36162C2.30512 3.09849 2.44756 2.85669 2.63476 2.65162C2.82196 2.44655 3.0498 2.28271 3.30379 2.17052C3.55777 2.05833 3.83233 2.00026 4.10999 2H7.10999C7.59531 1.99522 8.06679 2.16708 8.43376 2.48353C8.80073 2.79999 9.04207 3.23945 9.11999 3.72C9.28562 4.68007 9.56937 5.62273 9.96999 6.52C10.1114 6.88804 10.1634 7.28532 10.1219 7.678C10.0804 8.07068 9.94627 8.44866 9.72999 8.78L8.72999 10.28C9.97837 12.1811 11.8189 14.0216 13.72 15.27L15.22 14.27C15.5513 14.0537 15.9293 13.9196 16.322 13.8781C16.7147 13.8366 17.112 13.8886 17.48 14.03C18.3773 14.4306 19.3199 14.7144 20.28 14.88C20.7658 14.9593 21.2094 15.2032 21.5265 15.5715C21.8437 15.9399 22.0122 16.4122 22 16.92Z"
                  stroke="currentColor"
                  stroke-width="2"
                  stroke-linecap="round"
                  stroke-linejoin="round"
                />
              </svg>
              {{ 'settings.form.phone' | translate }}
            </label>
            <div class="input-container">
              <input
                type="text"
                class="form-input-modern"
                id="phone"
                name="phone"
                [placeholder]="'settings.form.phone.placeholder' | translate"
                formControlName="phone"
              />
              <div class="input-icon">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none">
                  <path
                    d="M22 16.92V19.92C22.0011 20.1985 21.9441 20.4742 21.8325 20.7293C21.7209 20.9845 21.5573 21.2136 21.3521 21.4019C21.1468 21.5901 20.9046 21.7335 20.6407 21.8227C20.3769 21.9119 20.0974 21.9451 19.82 21.92C16.7428 21.5856 13.787 20.5341 11.19 18.85C8.77382 17.3147 6.72533 15.2662 5.18999 12.85C3.49997 10.2412 2.44824 7.27099 2.11999 4.18C2.095 3.90347 2.12787 3.62476 2.21649 3.36162C2.30512 3.09849 2.44756 2.85669 2.63476 2.65162C2.82196 2.44655 3.0498 2.28271 3.30379 2.17052C3.55777 2.05833 3.83233 2.00026 4.10999 2H7.10999C7.59531 1.99522 8.06679 2.16708 8.43376 2.48353C8.80073 2.79999 9.04207 3.23945 9.11999 3.72C9.28562 4.68007 9.56937 5.62273 9.96999 6.52C10.1114 6.88804 10.1634 7.28532 10.1219 7.678C10.0804 8.07068 9.94627 8.44866 9.72999 8.78L8.72999 10.28C9.97837 12.1811 11.8189 14.0216 13.72 15.27L15.22 14.27C15.5513 14.0537 15.9293 13.9196 16.322 13.8781C16.7147 13.8366 17.112 13.8886 17.48 14.03C18.3773 14.4306 19.3199 14.7144 20.28 14.88C20.7658 14.9593 21.2094 15.2032 21.5265 15.5715C21.8437 15.9399 22.0122 16.4122 22 16.92Z"
                    stroke="currentColor"
                    stroke-width="2"
                    stroke-linecap="round"
                    stroke-linejoin="round"
                  />
                </svg>
              </div>
            </div>
          </div>

          @if (languages && languages.length > 0) {
            <div class="mb-3">
              <label for="langKey" jhiTranslate="settings.form.language">{{ 'settings.form.language' | translate }}</label>
              <select class="form-control" id="langKey" name="langKey" formControlName="langKey" data-cy="langKey">
                @for (language of languages; track $index) {
                  <option [value]="language">{{ language | findLanguageFromKey }}</option>
                }
              </select>
            </div>
          }

          <div class="d-flex gap-2">
            <button
              type="submit"
              [disabled]="settingsForm.invalid"
              class="btn btn-primary"
              data-cy="submit"
              jhiTranslate="settings.form.button"
            >
              {{ 'settings.form.button' | translate }}
            </button>
            <button type="button" (click)="togglePasswordForm()" class="btn btn-outline-secondary">
              {{ showPasswordForm() ? ('global.cancel' | translate) : ('settings.form.changePassword' | translate) }}
            </button>
          </div>
        </form>

        <!-- Password Change Form -->
        @if (showPasswordForm()) {
          <div class="password-section">
            <h3 class="password-title">{{ 'settings.form.changePassword' | translate }}</h3>

            @if (passwordSuccess()) {
              <div class="alert alert-success" jhiTranslate="password.messages.success">
                <strong>Votre mot de passe a été modifié !</strong>
              </div>
            }

            @if (passwordError()) {
              <div class="alert alert-danger" jhiTranslate="password.messages.error">
                <strong>Une erreur est survenue lors de la modification du mot de passe !</strong>
              </div>
            }

            <form name="passwordForm" (ngSubmit)="changePassword()" [formGroup]="passwordForm" novalidate>
              @if (!isOAuth2User()) {
                <div class="mb-3">
                  <label class="form-label" for="currentPassword" jhiTranslate="global.form.currentpassword.label">
                    {{ 'global.form.currentpassword.label' | translate }}
                  </label>
                  <input
                    type="password"
                    class="form-control"
                    id="currentPassword"
                    name="currentPassword"
                    placeholder="{{ 'global.form.currentpassword.placeholder' | translate }}"
                    formControlName="currentPassword"
                    data-cy="currentPassword"
                  />
                  @let currentPasswordRef = passwordForm.get('currentPassword')!;
                  @if (currentPasswordRef.invalid && (currentPasswordRef.dirty || currentPasswordRef.touched)) {
                    <div>
                      @if (currentPasswordRef?.errors?.required) {
                        <small class="form-text text-danger" jhiTranslate="global.messages.validate.newpassword.required">
                          Votre mot de passe actuel est requis.
                        </small>
                      }
                    </div>
                  }
                </div>
              } @else {
                <div class="mb-3">
                  <div class="alert alert-info">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" style="margin-right: 8px">
                      <circle cx="12" cy="12" r="10" stroke="currentColor" stroke-width="2" />
                      <path d="M12 16V12" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
                      <path d="M12 8H12.01" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
                    </svg>
                    <strong>{{ 'settings.oauth.googleAccount' | translate }}</strong>
                    {{ 'settings.oauth.googleAccountMessage' | translate }}
                  </div>
                </div>
              }

              <div class="mb-3">
                <label class="form-label" for="newPassword" jhiTranslate="global.form.newpassword.label">{{
                  'global.form.newpassword.label' | translate
                }}</label>
                <input
                  type="password"
                  class="form-control"
                  id="newPassword"
                  name="newPassword"
                  placeholder="{{ 'global.form.newpassword.placeholder' | translate }}"
                  formControlName="newPassword"
                  data-cy="newPassword"
                />
                @let newPasswordRef = passwordForm.get('newPassword')!;
                @if (newPasswordRef.invalid && (newPasswordRef.dirty || newPasswordRef.touched)) {
                  <div>
                    @if (newPasswordRef?.errors?.required) {
                      <small class="form-text text-danger" jhiTranslate="global.messages.validate.newpassword.required">
                        Votre nouveau mot de passe est requis.
                      </small>
                    }
                    @if (newPasswordRef?.errors?.minlength) {
                      <small class="form-text text-danger" jhiTranslate="global.messages.validate.newpassword.minlength">
                        Votre nouveau mot de passe doit comporter au moins 4 caractères.
                      </small>
                    }
                    @if (newPasswordRef?.errors?.maxlength) {
                      <small class="form-text text-danger" jhiTranslate="global.messages.validate.newpassword.maxlength">
                        Votre nouveau mot de passe ne doit pas comporter plus de 100 caractères.
                      </small>
                    }
                  </div>
                }
              </div>

              <div class="mb-3">
                <label class="form-label" for="confirmPassword" jhiTranslate="global.form.confirmpassword.label">
                  {{ 'global.form.confirmpassword.label' | translate }}
                </label>
                <input
                  type="password"
                  class="form-control"
                  id="confirmPassword"
                  name="confirmPassword"
                  placeholder="{{ 'global.form.confirmpassword.placeholder' | translate }}"
                  formControlName="confirmPassword"
                  data-cy="confirmPassword"
                />
                @let confirmPasswordRef = passwordForm.get('confirmPassword')!;
                @if (confirmPasswordRef.invalid && (confirmPasswordRef.dirty || confirmPasswordRef.touched)) {
                  <div>
                    @if (confirmPasswordRef?.errors?.required) {
                      <small class="form-text text-danger" jhiTranslate="global.messages.validate.confirmpassword.required">
                        La confirmation de votre nouveau mot de passe est requise.
                      </small>
                    }
                  </div>
                }
              </div>

              <div class="d-flex gap-2">
                <button
                  type="submit"
                  [disabled]="
                    isOAuth2User()
                      ? !passwordForm.get('newPassword')?.valid || !passwordForm.get('confirmPassword')?.valid
                      : passwordForm.invalid
                  "
                  class="btn btn-primary"
                  data-cy="submit"
                  jhiTranslate="password.form.button"
                >
                  {{ isOAuth2User() ? ('password.form.setPassword' | translate) : ('password.form.changePassword' | translate) }}
                </button>
                <button type="button" (click)="togglePasswordForm()" class="btn btn-outline-secondary">
                  {{ 'global.cancel' | translate }}
                </button>
              </div>
            </form>
          </div>
        }
      }
    </div>
  </div>
</div>
