<div class="ticket-payment-container">
  <!-- Affichage des informations de paiement -->
  <div *ngIf="paymentInfo?.paymentRequired" class="payment-info">
    <div class="payment-alert">
      <i class="fas fa-credit-card"></i>
      <span>Ce ticket nécessite un paiement de {{ paymentInfo?.amount }} {{ paymentInfo?.currency }}</span>
    </div>
  </div>

  <!-- Virement bancaire (seul moyen de paiement) -->
  <!-- On l'affiche dès que le composant a tenté de charger ou a des données -->
  <div *ngIf="shouldDisplayContent()" class="transfer-info">
    <div class="alert alert-secondary">
      <strong>Virement bancaire</strong><br />
      <strong>Banque :</strong> CIH BANK<br />
      <strong>Titulaire :</strong> MOUHCINE CHERQUI<br />
      IBAN : MA64 2302 7035 5923 3211 0334 0052<br />
      BIC / SWIFT : CIHMMAMC<br />
      Référence à indiquer : Ticket #{{ ticketId }}<br />
      Montant : {{ paymentStatus?.paymentAmount || paymentInfo?.amount || 0 }}
      {{ paymentStatus?.paymentCurrency || paymentInfo?.currency || 'MAD' }}<br />
      Envoyez le justificatif à contact.devtechly&#64;gmail.com pour validation rapide.
      <div class="proof-upload">
        <label class="form-label" for="transferProof">Joindre le justificatif (capture ou PDF)</label>
        <input
          id="transferProof"
          type="file"
          class="form-control"
          accept="image/*,.pdf"
          (change)="onTransferProofSelected($event)"
          [disabled]="uploadingProof"
        />
        <div class="proof-hint">Formats acceptés : images ou PDF, max ~10 Mo.</div>
        <div *ngIf="transferProofName" class="proof-selected">Fichier sélectionné : {{ transferProofName }}</div>
        <button
          *ngIf="selectedProofFile"
          type="button"
          class="btn btn-primary btn-sm mt-2"
          [disabled]="uploadingProof"
          (click)="uploadProof()"
        >
          <span *ngIf="!uploadingProof">Envoyer le justificatif</span>
          <span *ngIf="uploadingProof">Envoi en cours...</span>
        </button>
        <div *ngIf="proofUploadSuccess" class="alert alert-success mt-2 mb-0">
          Justificatif envoyé. L'administration pourra le consulter pour validation.
        </div>
      </div>
    </div>
  </div>

  <!-- Statut de paiement pour un ticket existant -->
  <div *ngIf="paymentStatus" class="payment-status">
    <div class="status-card">
      <div class="status-header">
        <h5>Statut du paiement</h5>
      </div>

      <div class="status-content">
        <div class="status-item">
          <span class="label">Montant:</span>
          <span class="value">{{ paymentStatus.paymentAmount }} {{ paymentStatus.paymentCurrency }}</span>
        </div>

        <div class="status-item">
          <span class="label">Type:</span>
          <span class="value">{{ paymentStatus.paymentType }}</span>
        </div>

        <div class="status-item">
          <span class="label">Statut:</span>
          <span class="value status-badge" [ngClass]="getPaymentStatusClass(paymentStatus.paymentStatus)">
            {{ getPaymentStatusText(paymentStatus.paymentStatus) }}
          </span>
        </div>
      </div>
    </div>
  </div>

  <!-- Messages d'erreur -->
  <div *ngIf="errorMessage" class="error-message">
    <div class="alert alert-danger">
      <i class="fas fa-exclamation-triangle"></i>
      {{ errorMessage }}
    </div>
  </div>

  <!-- Indicateur de chargement supprimé (virement bancaire affiché sans spinner) -->

  <!-- État neutre si rien à afficher mais qu'on a tenté de charger -->
  <div *ngIf="!isLoading && !paymentStatus && !paymentInfo && shouldDisplayContent()" class="payment-empty">
    <div class="alert alert-info">
      <i class="fas fa-info-circle"></i>
      Paiement en cours d'initialisation. Veuillez réessayer ou contacter le support si le problème persiste.
    </div>
  </div>
</div>
