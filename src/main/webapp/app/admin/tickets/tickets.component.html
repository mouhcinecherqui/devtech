<h2>{{ 'ticketsAdmin.title' | translate }}</h2>
<p>{{ 'ticketsAdmin.subtitle' | translate }}</p>
<div *ngIf="loading">{{ 'ticketsAdmin.loading' | translate }}</div>
<div *ngIf="error" class="error">{{ error }}</div>
<table *ngIf="tickets.length && !loading">
  <thead>
    <tr>
      <th>{{ 'ticketsAdmin.id' | translate }}</th>
      <th>{{ 'ticketsAdmin.type' | translate }}</th>
      <th>{{ 'ticketsAdmin.description' | translate }}</th>
      <th>{{ 'ticketsAdmin.status' | translate }}</th>
      <th>{{ 'ticketsAdmin.created' | translate }}</th>
      <th>{{ 'ticketsAdmin.actions' | translate }}</th>
    </tr>
  </thead>
  <tbody>
    <tr *ngFor="let ticket of tickets">
      <td>{{ ticket.id }}</td>
      <td>{{ 'parameters.interface.' + ticket.type | translate }}</td>
      <td>{{ ticket.description }}</td>
      <td>{{ 'parameters.interface.' + ticket.status | translate }}</td>
      <td>{{ ticket.createdDate | date: 'short' }}</td>
      <td>
        <button class="btn btn-primary btn-sm" (click)="openDetailModal(ticket)">{{ 'ticketsAdmin.detail' | translate }}</button>
      </td>
    </tr>
  </tbody>
</table>
<div *ngIf="!tickets.length && !loading && !error">{{ 'ticketsAdmin.noTickets' | translate }}</div>

<!-- Modale de dÃ©tail/modification du ticket -->
<div
  *ngIf="showDetailModal"
  style="
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: rgba(0, 0, 0, 0.3);
    z-index: 9999;
    display: flex;
    align-items: center;
    justify-content: center;
  "
>
  <div class="admin-ticket-modal">
    <button (click)="closeDetailModal()" class="close-modal-btn" aria-label="Fermer">
      <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
        <circle cx="12" cy="12" r="12" fill="#e0e7ef" />
        <path d="M8 8L16 16M16 8L8 16" stroke="#2563eb" stroke-width="2" stroke-linecap="round" />
      </svg>
    </button>
    <h3>{{ 'ticketsAdmin.detail' | translate }}</h3>
    <div *ngIf="selectedTicket">
      <div class="admin-ticket-row">
        <div class="admin-ticket-label">{{ 'ticketsAdmin.type' | translate }} :</div>
        <div class="admin-ticket-value">{{ 'parameters.interface.' + selectedTicket?.type | translate }}</div>
      </div>
      <div class="admin-ticket-row">
        <div class="admin-ticket-label">{{ 'ticketsAdmin.description' | translate }} :</div>
        <div class="admin-ticket-value">{{ selectedTicket.description }}</div>
      </div>
      <div class="admin-ticket-row">
        <div class="admin-ticket-label">{{ 'ticketsAdmin.status' | translate }} :</div>
        <div class="admin-ticket-value">
          {{ 'parameters.interface.' + selectedTicket?.status | translate }}
        </div>
      </div>
      <div class="admin-ticket-row">
        <div class="admin-ticket-label" style="align-self: flex-start">{{ 'ticketsAdmin.messages' | translate }}</div>
        <div class="admin-ticket-value" style="width: 100%">
          <ul class="admin-ticket-messages">
            <li *ngFor="let msg of selectedTicket.messages">{{ msg }}</li>
          </ul>
          <textarea [(ngModel)]="newMessage" rows="2" placeholder="{{ 'ticketsAdmin.addMessage' | translate }}"></textarea>
        </div>
      </div>
      <div class="admin-ticket-actions">
        <button class="btn btn-success btn-sm" (click)="saveTicket()">{{ 'ticketsAdmin.save' | translate }}</button>
      </div>
    </div>
  </div>
</div>
